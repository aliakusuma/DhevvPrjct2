local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInput = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- Hapus UI lama jika ada
if CoreGui:FindFirstChild("RealChatUI") then
    CoreGui:FindFirstChild("RealChatUI"):Destroy()
end

-- =======================
-- BUAT UI
-- =======================

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RealChatUI"
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = CoreGui

-- Tombol toggle (selalu terlihat)
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0, 60, 0, 60)
toggleButton.Position = UDim2.new(0.94, 0, 0.87, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
toggleButton.Text = "ðŸ’¬"
toggleButton.TextColor3 = Color3.white
toggleButton.TextSize = 28
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.Parent = screenGui

-- Window chat (awalnya tersembunyi)
local chatWindow = Instance.new("Frame")
chatWindow.Name = "ChatWindow"
chatWindow.Size = UDim2.new(0.35, 0, 0.5, 0)
chatWindow.Position = UDim2.new(0.6, 0, 0.25, 0)
chatWindow.BackgroundColor3 = Color3.fromRGB(30, 35, 45)
chatWindow.BorderSizePixel = 0
chatWindow.Visible = false
chatWindow.Parent = screenGui

-- Header window
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0.08, 0)
header.BackgroundColor3 = Color3.fromRGB(0, 80, 200)
header.Parent = chatWindow

local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.7, 0, 1, 0)
title.BackgroundTransparency = 1
title.Text = "EXECUTOR CHAT"
title.TextColor3 = Color3.white
title.Font = Enum.Font.SourceSansBold
title.TextSize = 16
title.Parent = header

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0.3, 0, 1, 0)
closeButton.Position = UDim2.new(0.7, 0, 0, 0)
closeButton.Text = "CLOSE"
closeButton.TextColor3 = Color3.white
closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeButton.Font = Enum.Font.SourceSansBold
closeButton.Parent = header

-- Area pesan
local messagesFrame = Instance.new("ScrollingFrame")
messagesFrame.Size = UDim2.new(1, 0, 0.77, 0)
messagesFrame.Position = UDim2.new(0, 0, 0.08, 0)
messagesFrame.BackgroundColor3 = Color3.fromRGB(20, 25, 35)
messagesFrame.ScrollBarThickness = 6
messagesFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
messagesFrame.Parent = chatWindow

local messagesLayout = Instance.new("UIListLayout")
messagesLayout.Padding = UDim.new(0, 10)
messagesLayout.Parent = messagesFrame

local messagesPadding = Instance.new("UIPadding")
messagesPadding.PaddingLeft = UDim.new(0, 10)
messagesPadding.PaddingRight = UDim.new(0, 10)
messagesPadding.PaddingTop = UDim.new(0, 10)
messagesPadding.Parent = messagesFrame

-- Area input
local inputFrame = Instance.new("Frame")
inputFrame.Size = UDim2.new(1, 0, 0.15, 0)
inputFrame.Position = UDim2.new(0, 0, 0.85, 0)
inputFrame.BackgroundColor3 = Color3.fromRGB(40, 45, 55)
inputFrame.Parent = chatWindow

local inputBox = Instance.new("TextBox")
inputBox.Size = UDim2.new(0.7, 0, 0.7, 0)
inputBox.Position = UDim2.new(0.02, 0, 0.15, 0)
inputBox.BackgroundColor3 = Color3.fromRGB(50, 55, 65)
inputBox.BorderSizePixel = 0
inputBox.TextColor3 = Color3.white
inputBox.Font = Enum.Font.SourceSans
inputBox.PlaceholderText = "Type your message here..."
inputBox.TextSize = 14
inputBox.Parent = inputFrame

local sendButton = Instance.new("TextButton")
sendButton.Size = UDim2.new(0.25, 0, 0.7, 0)
sendButton.Position = UDim2.new(0.73, 0, 0.15, 0)
sendButton.Text = "SEND"
sendButton.TextColor3 = Color3.white
sendButton.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
sendButton.Font = Enum.Font.SourceSansBold
sendButton.Parent = inputFrame

-- =======================
-- VARIABEL & FUNGSI
-- =======================

local chatMessages = {}
local messageCount = 0

-- Fungsi tambah pesan
function addMessage(senderName, messageText, isSystemMessage)
    messageCount = messageCount + 1
    
    -- Buat frame pesan
    local messageFrame = Instance.new("Frame")
    messageFrame.Name = "Message" .. messageCount
    messageFrame.Size = UDim2.new(1, -20, 0, 0)
    messageFrame.BackgroundTransparency = 1
    messageFrame.AutomaticSize = Enum.AutomaticSize.Y
    
    -- Label pengirim
    local senderLabel = Instance.new("TextLabel")
    senderLabel.Size = UDim2.new(1, 0, 0, 20)
    senderLabel.BackgroundTransparency = 1
    senderLabel.Text = isSystemMessage and "[SYSTEM] " .. senderName or "[" .. senderName .. "]"
    senderLabel.TextColor3 = isSystemMessage and Color3.fromRGB(255, 100, 100) or Color3.fromRGB(100, 200, 255)
    senderLabel.Font = Enum.Font.SourceSansBold
    senderLabel.TextSize = 14
    senderLabel.TextXAlignment = Enum.TextXAlignment.Left
    senderLabel.Parent = messageFrame
    
    -- Label pesan
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 0, 0)
    textLabel.Position = UDim2.new(0, 0, 0, 20)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = messageText
    textLabel.TextColor3 = Color3.white
    textLabel.Font = Enum.Font.SourceSans
    textLabel.TextSize = 14
    textLabel.TextWrapped = true
    textLabel.AutomaticSize = Enum.AutomaticSize.Y
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.Parent = messageFrame
    
    -- Tambah ke frame
    messageFrame.Parent = messagesFrame
    
    -- Scroll ke bawah
    wait(0.05)
    messagesFrame.CanvasPosition = Vector2.new(0, messagesFrame.AbsoluteCanvasSize.Y)
    
    -- Simpan pesan
    table.insert(chatMessages, {
        sender = senderName,
        message = messageText,
        time = os.time()
    })
    
    -- Print ke console
    print("[Executor Chat] " .. senderName .. ": " .. messageText)
end

-- Fungsi kirim pesan
function sendMessage()
    local text = string.gsub(inputBox.Text, "^%s*(.-)%s*$", "%1")
    
    if text ~= "" and text ~= " " then
        addMessage(player.Name, text, false)
        inputBox.Text = ""
        inputBox:CaptureFocus()
    end
end

-- =======================
-- EVENT HANDLERS
-- =======================

-- Toggle window
toggleButton.MouseButton1Click:Connect(function()
    chatWindow.Visible = not chatWindow.Visible
    if chatWindow.Visible then
        inputBox:CaptureFocus()
    end
end)

-- Close window
closeButton.MouseButton1Click:Connect(function()
    chatWindow.Visible = false
end)

-- Kirim pesan saat tombol send
sendButton.MouseButton1Click:Connect(function()
    sendMessage()
end)

-- Kirim pesan saat enter
inputBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        sendMessage()
    end
end)

-- Hotkey F9
UserInput.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F9 then
        chatWindow.Visible = not chatWindow.Visible
        if chatWindow.Visible then
            inputBox:CaptureFocus()
        end
    end
end)

-- =======================
-- INISIALISASI
-- =======================

-- Pesan sistem awal
addMessage("SYSTEM", "Executor Chat System Loaded", true)
addMessage("SYSTEM", "This is a separate chat from Roblox", true)
addMessage("SYSTEM", "Press F9 or click ðŸ’¬ button", true)
addMessage("SYSTEM", "Type your message below", true)

-- Test message
addMessage("BOT", "Chat system is working!", false)

-- =======================
-- FUNGSI TAMBAHAN
-- =======================

-- Buat window bisa di-drag
local isDragging = false
local dragStartPosition, windowStartPosition

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = true
        dragStartPosition = input.Position
        windowStartPosition = chatWindow.Position
    end
end)

header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = false
    end
end)

UserInput.InputChanged:Connect(function(input)
    if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStartPosition
        chatWindow.Position = UDim2.new(
            windowStartPosition.X.Scale,
            windowStartPosition.X.Offset + delta.X,
            windowStartPosition.Y.Scale,
            windowStartPosition.Y.Offset + delta.Y
        )
    end
end)

-- =======================
-- OUTPUT KONFIRMASI
-- =======================
print("========================================")
print("âœ… EXECUTOR CHAT SYSTEM LOADED")
print("âœ… Press F9 or click ðŸ’¬ button")
print("âœ… Chat is separate from Roblox chat")
print("========================================")

-- Auto test
wait(1)
addMessage("SYSTEM", "Chat system is ready to use!", true)
