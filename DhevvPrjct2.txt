-- HYPERION CHAT - REAL WORKING CHAT FOR EXECUTORS
local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local UI = game:GetService("UserInputService")
local CG = game:GetService("CoreGui")
local RS = game:GetService("ReplicatedStorage")
local HS = game:GetService("HttpService")

-- UNIQUE CHAT ID (gunakan LP.UserId untuk unique)
local CHAT_ID = "EXEC_CHAT_" .. tostring(LP.UserId)
local CHAT_CHANNEL = "GLOBAL_EXEC_CHAT"

-- SIMPAN PESAN GLOBAL (sementara)
_G.ExecutorChatMessages = _G.ExecutorChatMessages or {}
_G.ExecutorChatUsers = _G.ExecutorChatUsers or {}

-- HAPUS UI LAMA
if CG:FindFirstChild("HyperionChat") then
    CG:FindFirstChild("HyperionChat"):Destroy()
end

-- CREATE SCREENGUI
local SG = Instance.new("ScreenGui")
SG.Name = "HyperionChat"
SG.ResetOnSpawn = false
SG.DisplayOrder = 999
SG.Parent = CG

-- MINIMIZED BUTTON (Always Visible)
local MinBtn = Instance.new("TextButton")
MinBtn.Name = "MinimizedButton"
MinBtn.Size = UDim2.new(0, 60, 0, 60)
MinBtn.Position = UDim2.new(0.93, 0, 0.85, 0)
MinBtn.BackgroundColor3 = Color3.fromRGB(40, 120, 240)
MinBtn.BackgroundTransparency = 0.2
MinBtn.Text = "ğŸ’¬"
MinBtn.TextColor3 = Color3.white
MinBtn.TextSize = 28
MinBtn.Font = Enum.Font.SourceSansBold
MinBtn.Parent = SG

-- CHAT WINDOW
local Window = Instance.new("Frame")
Window.Name = "ChatWindow"
Window.Size = UDim2.new(0.4, 0, 0.55, 0)
Window.Position = UDim2.new(0.58, 0, 0.22, 0)
Window.BackgroundColor3 = Color3.fromRGB(15, 20, 30)
Window.BorderSizePixel = 0
Window.Visible = false
Window.Parent = SG

-- TITLE BAR
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0.07, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(30, 100, 200)
TitleBar.Parent = Window

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(0.6, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "ğŸ’¬ EXECUTORS CHAT"
Title.TextColor3 = Color3.white
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 16
Title.Parent = TitleBar

local OnlineCount = Instance.new("TextLabel")
OnlineCount.Size = UDim2.new(0.3, 0, 1, 0)
OnlineCount.Position = UDim2.new(0.6, 0, 0, 0)
OnlineCount.BackgroundTransparency = 1
OnlineCount.Text = "Online: 1"
OnlineCount.TextColor3 = Color3.fromRGB(100, 255, 100)
OnlineCount.Font = Enum.Font.Code
OnlineCount.TextSize = 14
OnlineCount.Parent = TitleBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0.1, 0, 1, 0)
CloseBtn.Position = UDim2.new(0.9, 0, 0, 0)
CloseBtn.Text = "âœ•"
CloseBtn.TextColor3 = Color3.white
CloseBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
CloseBtn.Font = Enum.Font.SourceSansBold
CloseBtn.Parent = TitleBar

-- MESSAGES CONTAINER
local MessagesFrame = Instance.new("ScrollingFrame")
MessagesFrame.Size = UDim2.new(1, 0, 0.78, 0)
MessagesFrame.Position = UDim2.new(0, 0, 0.07, 0)
MessagesFrame.BackgroundColor3 = Color3.fromRGB(10, 15, 25)
MessagesFrame.ScrollBarThickness = 6
MessagesFrame.ScrollBarImageColor3 = Color3.fromRGB(40, 120, 240)
MessagesFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
MessagesFrame.Parent = Window

local MsgLayout = Instance.new("UIListLayout")
MsgLayout.Padding = UDim.new(0, 8)
MsgLayout.Parent = MessagesFrame

local MsgPadding = Instance.new("UIPadding")
MsgPadding.PaddingLeft = UDim.new(0, 10)
MsgPadding.PaddingRight = UDim.new(0, 10)
MsgPadding.PaddingTop = UDim.new(0, 10)
MsgPadding.Parent = MessagesFrame

-- INPUT AREA
local InputFrame = Instance.new("Frame")
InputFrame.Size = UDim2.new(1, 0, 0.15, 0)
InputFrame.Position = UDim2.new(0, 0, 0.85, 0)
InputFrame.BackgroundColor3 = Color3.fromRGB(25, 30, 45)
InputFrame.Parent = Window

local InputBox = Instance.new("TextBox")
InputBox.Size = UDim2.new(0.7, 0, 0.7, 0)
InputBox.Position = UDim2.new(0.02, 0, 0.15, 0)
InputBox.BackgroundColor3 = Color3.fromRGB(35, 40, 60)
InputBox.BorderSizePixel = 0
InputBox.TextColor3 = Color3.white
InputBox.Font = Enum.Font.SourceSans
InputBox.PlaceholderText = "Type message (visible to all executors)..."
InputBox.TextSize = 14
InputBox.Parent = InputFrame

local SendBtn = Instance.new("TextButton")
SendBtn.Size = UDim2.new(0.25, 0, 0.7, 0)
SendBtn.Position = UDim2.new(0.73, 0, 0.15, 0)
SendBtn.Text = "SEND"
SendBtn.TextColor3 = Color3.white
SendBtn.BackgroundColor3 = Color3.fromRGB(40, 120, 240)
SendBtn.Font = Enum.Font.SourceSansBold
SendBtn.TextSize = 14
SendBtn.Parent = InputFrame

-- GLOBAL MESSAGE STORAGE SYSTEM
_G.ExecutorChatData = _G.ExecutorChatData or {
    Messages = {},
    Users = {}
}

-- REGISTER CURRENT USER
_G.ExecutorChatData.Users[LP.UserId] = {
    Name = LP.Name,
    JoinTime = os.time()
}

-- FUNCTION TO ADD MESSAGE
local function AddGlobalMessage(sender, message, isSystem)
    local msgId = #_G.ExecutorChatData.Messages + 1
    local timestamp = os.time()
    
    _G.ExecutorChatData.Messages[msgId] = {
        Sender = sender,
        Message = message,
        Time = timestamp,
        System = isSystem,
        SenderId = isSystem and 0 or LP.UserId
    }
    
    -- Update display
    local MsgContainer = Instance.new("Frame")
    MsgContainer.Size = UDim2.new(1, -20, 0, 0)
    MsgContainer.BackgroundTransparency = 1
    MsgContainer.AutomaticSize = Enum.AutomaticSize.Y
    
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 20)
    Header.BackgroundTransparency = 1
    Header.Parent = MsgContainer
    
    local SenderText = Instance.new("TextLabel")
    SenderText.Size = UDim2.new(0.7, 0, 1, 0)
    SenderText.BackgroundTransparency = 1
    SenderText.Text = isSystem and "âš¡ " .. sender or "ğŸ‘¤ " .. sender
    SenderText.TextColor3 = isSystem and Color3.fromRGB(255, 150, 50) or Color3.fromRGB(100, 200, 255)
    SenderText.Font = Enum.Font.SourceSansBold
    SenderText.TextSize = 14
    SenderText.TextXAlignment = Enum.TextXAlignment.Left
    SenderText.Parent = Header
    
    local TimeText = Instance.new("TextLabel")
    TimeText.Size = UDim2.new(0.3, 0, 1, 0)
    TimeText.Position = UDim2.new(0.7, 0, 0, 0)
    TimeText.BackgroundTransparency = 1
    TimeText.Text = os.date("%H:%M")
    TimeText.TextColor3 = Color3.fromRGB(150, 150, 150)
    TimeText.Font = Enum.Font.Code
    TimeText.TextSize = 12
    TimeText.TextXAlignment = Enum.TextXAlignment.Right
    TimeText.Parent = Header
    
    local MessageText = Instance.new("TextLabel")
    MessageText.Size = UDim2.new(1, 0, 0, 0)
    MessageText.Position = UDim2.new(0, 0, 0, 20)
    MessageText.BackgroundTransparency = 1
    MessageText.Text = message
    MessageText.TextColor3 = Color3.white
    MessageText.Font = Enum.Font.SourceSans
    MessageText.TextSize = 14
    MessageText.TextWrapped = true
    MessageText.AutomaticSize = Enum.AutomaticSize.Y
    MessageText.TextXAlignment = Enum.TextXAlignment.Left
    MessageText.Parent = MsgContainer
    
    MsgContainer.Parent = MessagesFrame
    
    -- Auto scroll
    task.wait(0.05)
    MessagesFrame.CanvasPosition = Vector2.new(0, MessagesFrame.AbsoluteCanvasSize.Y)
    
    -- Print to output
    print("[Executor Chat] " .. sender .. ": " .. message)
end

-- FUNCTION TO SEND MESSAGE
local function SendGlobalMessage()
    local text = string.gsub(InputBox.Text, "^%s*(.-)%s*$", "%1")
    if text == "" then return end
    
    -- Add to global storage
    AddGlobalMessage(LP.Name, text, false)
    
    -- Clear input
    InputBox.Text = ""
    InputBox:CaptureFocus()
    
    -- Also store in player's chat history
    local playerMsgs = _G.ExecutorChatData[LP.UserId] or {}
    table.insert(playerMsgs, {
        Text = text,
        Time = os.time()
    })
    _G.ExecutorChatData[LP.UserId] = playerMsgs
end

-- FUNCTION TO CHECK OTHER EXECUTORS
local function UpdateOnlineUsers()
    local count = 0
    for _, _ in pairs(_G.ExecutorChatData.Users or {}) do
        count = count + 1
    end
    OnlineCount.Text = "Online: " .. count
end

-- EVENT HANDLERS
MinBtn.MouseButton1Click:Connect(function()
    Window.Visible = not Window.Visible
    if Window.Visible then
        InputBox:CaptureFocus()
        UpdateOnlineUsers()
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    Window.Visible = false
end)

SendBtn.MouseButton1Click:Connect(SendGlobalMessage)

InputBox.FocusLost:Connect(function(enterPressed)
    if enterPressed and UI:IsKeyDown(Enum.KeyCode.Return) then
        SendGlobalMessage()
    end
end)

-- HOTKEY (F8)
UI.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F8 then
        Window.Visible = not Window.Visible
        if Window.Visible then
            InputBox:CaptureFocus()
            UpdateOnlineUsers()
        end
    end
end)

-- DRAGGABLE WINDOW
local dragging = false
local dragStart, startPos

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Window.Position
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

UI.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        Window.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- LOAD EXISTING MESSAGES
local function LoadExistingMessages()
    -- Add system messages
    AddGlobalMessage("SYSTEM", "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•", true)
    AddGlobalMessage("SYSTEM", "   EXECUTOR CHAT v2.0", true)
    AddGlobalMessage("SYSTEM", "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•", true)
    AddGlobalMessage("SYSTEM", "All users with this script", true)
    AddGlobalMessage("SYSTEM", "can see these messages!", true)
    AddGlobalMessage("SYSTEM", "Press F8 or click ğŸ’¬ button", true)
    
    -- Load previous messages from global storage
    for i, msg in ipairs(_G.ExecutorChatData.Messages or {}) do
        if i > 10 then break end -- Limit to last 10 messages
        if msg.Sender ~= "SYSTEM" then
            AddGlobalMessage(msg.Sender, msg.Message, msg.System)
        end
    end
end

-- INITIALIZE
LoadExistingMessages()
UpdateOnlineUsers()

-- AUTO-UPDATE LOOP
task.spawn(function()
    while true do
        wait(5)
        if Window.Visible then
            UpdateOnlineUsers()
        end
    end
end)

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("ğŸ’¬ EXECUTOR CHAT LOADED SUCCESSFULLY")
print("All executors can see this chat")
print("Press F8 or click ğŸ’¬ button")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
